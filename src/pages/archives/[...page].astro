---
import type { GetStaticPathsOptions } from 'astro';
import Paginator from '~/components/Paginator.astro';
import { PageSize } from '~/config';
import ScaffoldLayout from '~/layouts/ScaffoldLayout.astro';
import { getPosts } from '~/utils/collection';
import { withBase } from '~/utils/url';

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
	return paginate(await getPosts(false, 'desc'), { pageSize: PageSize });
}

const { page } = Astro.props;
const pageTitle =
	page.currentPage && page.currentPage > 1
		? `归档（第${page.currentPage}页）`
		: '归档';
---

<ScaffoldLayout title={pageTitle} description="全部文章归档" currentNav="Archives">
	{
		page.data.map((post) => {
			const date = post.data.lastmod || post.data.date;
			return (
				<div class="flex justify-between">
					<h5 class="text-xl">
						<a href={withBase(`/posts/${post.slug}`)} aria-label={`Read post: ${post.data.title}`}>
							{post.data.title}
						</a>
					</h5>
					{date && <time datetime={date.toISOString()}>{date.toLocaleDateString()}</time>}
				</div>
			);
		})
	}
	<Paginator {...page} />
</ScaffoldLayout>
